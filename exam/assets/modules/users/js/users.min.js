var base_url=$('input[name="base_url"]').val();function usersTable(){$("#usersTable").DataTable({processing:!0,serverSide:!0,responsive:!0,destroy:!0,order:[[0,"desc"]],columns:[{data:"user_id",width:"5%"},{data:"fullname",width:"20%"},{data:"birthdate",width:"15%"},{data:"salary",width:"15%"},{data:"description",width:"15%"},{data:"job_description",width:"20%",render:function(data,type,row,meta){var str="";return str+=`<a href="${base_url+"assets/uploads/pdf/"+row.job_description}" target="_blank">${row.job_description}</a>`}},{data:"user_id",width:"15%",render:function(data,type,row,meta){var str="";return str+='<button data-bs-toggle="modal" data-bs-target="#modal_updateUser" data-id="'+row.user_id+'" class="btn btn-sm btn-outline-warning updateUser" title="Click to update"><i class="fa fa-edit"></i></button>&nbsp;',str+='<button data-id="'+row.user_id+'" class="btn btn-sm btn-outline-danger removeUser" title="Click to remove"><i class="fa fa-times-circle"></i></button>'}}],language:{search:"",searchPlaceholder:"Search keyword...",infoFiltered:""},ajax:{url:base_url+"users/getUsersList",type:"POST"},columnDefs:[{targets:[5,6],orderable:!1}]})}function sendAjax(param={},isReturn=!0){if(!1===isReturn){var return_response=null;return $.ajax({url:param.url,type:"post",data:param.data,async:!1,processData:!1,contentType:!1,dataType:"json",beforeSend:function(){$(".overlay").show()},success:function(response){$(".overlay").hide(),console.log(response),return_response=response},error:function(e){console.log(e)}}),return_response}var return_data=null;if($.ajax({url:param.url,type:"post",data:param.data,async:!1,dataType:"json",success:function(response){return_data=response},error:function(e){console.log(e)}}),isReturn)return return_data}function confirm_swal(text,confirmBtnText){var isSuccess=!1;return new Promise((function(resolve,reject){Swal.fire({title:"Are you sure?",text:text,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:confirmBtnText}).then(result=>{result.value?resolve(!0):resolve(!1)})}))}function swal(content,response="success"){"success"==response?Swal.fire("Success",content,response):Swal.fire("Error",content,response)}function clearError(){$(".err").html("")}function input(element,value){$(element).val(value)}$(document).ready((function(){usersTable(),$(".birthdate").datepicker(),$(document).on("submit","#form_addUser",(function(e){var files;e.preventDefault(),clearError(),""==$('input[name="job_description"]').val()&&$(".fileSelected").parent().next(".err").html("Job Description Required")})),$(document).on("submit","#form_updateUser",(function(e){var files;if(e.preventDefault(),clearError(),""==$('input[name="job_description"]').val()){var form_data=new FormData($(".form_updateUser")[0]),sendAjaxVar=sendAjax({url:base_url+"users/updateUser",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_updateUser")[0].reset(),usersTable(),$("#modal_updateUser").modal("hide")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))}})),$("#form_addUser, #form_updateUser").fileupload({acceptFileTypes:/(\.|\/)(pdf)$/i,autoUpload:!1,add:function(e,data){$(".fileSelected").val(data.files[0].name),$(document).on("submit",".form_addUser",(function(e){e.preventDefault();var form_data=new FormData($(".form_addUser")[0]);form_data.append("job_description",data.files[0]);var sendAjaxVar=sendAjax({url:base_url+"users/addUser",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_addUser")[0].reset(),usersTable(),$("#modal_addUser").modal("hide")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("submit",".form_updateUser",(function(e){e.preventDefault();var form_data=new FormData($(".form_updateUser")[0]);form_data.append("job_description",data.files[0]);var sendAjaxVar=sendAjax({url:base_url+"users/updateUser",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_updateUser")[0].reset(),usersTable(),$("#modal_updateUser").modal("hide")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))}))}}),$(document).on("click",".updateUser",(function(){user_id=$(this).data("id");var data=sendAjax({url:base_url+"users/getUserInfo",data:{user_id:user_id}});$(".form_updateUser")[0].reset(),input('input[name="user_id"]',user_id),input('input[name="fullname"]',data.fullname),input('input[name="birthdate"]',data.birthdate),input('input[name="salary"]',data.salary),input('textarea[name="description"]',data.description),input('input[name="current_job_description"]',data.job_description),$(".form_addUser")[0].reset()})),$(document).on("click",".removeUser",(function(e){e.preventDefault();var user_id=$(this).data("id");confirm_swal("Are you sure you want to remove this User?","Remove").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"users/removeUser",data:{user_id:user_id}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),usersTable())}}))})),$(document).on("focus",".salary",(function(){$(this).val("")})),$(document).on("change",".salary",(function(){$(this).val("$"+$(this).val().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"))})),$(document).on("click",".exportPDF",(function(){window.open(base_url+"users/exportPDF","_blank")}))}));